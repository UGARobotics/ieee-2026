from phoenix6.hardware import TalonFX
from phoenix6.controls import DutyCycleOut
from phoenix6.configs import TalonFXConfiguration, CurrentLimitsConfigs
from phoenix6.unmanaged import feed_enable

import os
import time

os.environ["CTR_TARGET"] = "Hardware"

id = 0
duty = 0.05
canivore="Main" 
stator_current_limit=120 
stator_current_limit_enable=True
motor = TalonFX(id, canivore)

print("Initializing motor...")

print("Clearing faults...")
motor.clear_sticky_faults()
time.sleep(0.5)
print("Cleared.")

# Not sure if these current limits are actually needed. but why not?
print(f"Setting stator current limit to {stator_current_limit}...")
lmt_cfg = CurrentLimitsConfigs()
lmt_cfg.stator_current_limit = stator_current_limit
lmt_cfg.stator_current_limit_enable = stator_current_limit_enable
motor.configurator.apply(lmt_cfg)
time.sleep(0.5)
print(f"Current configurations applied.")

# Base configs should also already be applied but better to do it explicitly
# Note: Changes can be made here and above if the settings don't work with the bot
print("Applying base configurations...")
cfg = TalonFXConfiguration()
motor.configurator.apply(cfg)
time.sleep(0.5)
print("Base configurations applied.")

# yay
print(f"Motor {id} live!")
feed_enable(10) 
motor.set_control(DutyCycleOut(duty))

time.sleep(5)